CREATE DATABASE BTThucHanh1

GO


USE BTThucHanh1
GO
CREATE TABLE KHOA 
(
    MAKHOA NVARCHAR(5) ,
    TENKHOA NVARCHAR(50),
    DIENTHOAI NVARCHAR(20) NOT NULL,
    CONSTRAINT MAKHOA_PK PRIMARY KEY (MAKHOA)
)
GO

CREATE TABLE LOP 
(
    MALOP NVARCHAR(10),
    TENLOP NVARCHAR(60),
    KHOAHOC TINYINT NOT NULL,
    HEDAOTAO NVARCHAR(25) NOT NULL,
    NAMNHAPHOC SMALLINT NOT NULL,
	MAKHOA NVARCHAR(5) ,

    CONSTRAINT MALOP_PK PRIMARY KEY (MALOP),

	CONSTRAINT MAKHOA_FK FOREIGN KEY (MAKHOA)
	REFERENCES KHOA(MAKHOA)

	
)

GO
CREATE TABLE SINHVIEN 
(
    MASV NVARCHAR(10),
    HODEM NVARCHAR(25),
    TEN NVARCHAR(10),
    NGAYSINH SMALLDATETIME,
    GIOITINH bit,
    NOISINH NVARCHAR(100) NOT NULL,
    MALOP NVARCHAR(10),
    CONSTRAINT MASV_PK PRIMARY KEY (MASV),

	CONSTRAINT ORDER_FK FOREIGN KEY (MALOP)
	REFERENCES LOP(MALOP)
)
GO
CREATE TABLE HOCPHAN 
(
    MAHOCPHAN NVARCHAR(10),
    TENHOCPHAN NVARCHAR(50),
    SOTINCHI TINYINT,

    CONSTRAINT HOCPHAN_PK PRIMARY KEY (MAHOCPHAN)
	)
GO
CREATE TABLE DIEMTHI 
(
    MAHOCPHAN NVARCHAR(10),
    MASV NVARCHAR(10),
    LANTHI TINYINT,
    DIEM numeric(5, 2),


	CONSTRAINT MASV_FK FOREIGN KEY (MASV)
	REFERENCES SINHVIEN(MASV),

	CONSTRAINT MAHP_FK FOREIGN KEY (MAHOCPHAN)
	REFERENCES HOCPHAN(MAHOCPHAN)
)
GO

INSERT INTO dbo.KHOA
VALUES ('cnud' , N'Công nghệ thông tin ứng dụng ','0511-962962-445')
INSERT INTO dbo.KHOA
VALUES ('daic' , N'Đại cương','0511-962962-401')
INSERT INTO dbo.KHOA
VALUES ('khmt' , N'Khoa học máy tính ','0511-962962-479')
INSERT INTO dbo.KHOA
VALUES ('tmdt' , N'Thương mại điện tử ','0511-962962-414')

INSERT INTO dbo.LOP
VALUES ('dh01' , N'Đồ họa 1',1,N'Chính Quy',2007,'cnud')
INSERT INTO dbo.LOP
VALUES ('dh02' , N'Đồ họa 2',2,N'Chính Quy',2008,'cnud')
INSERT INTO dbo.LOP
VALUES ('dh03' , N'Đồ họa 3',3,N'Chính Quy',2009,'cnud')
INSERT INTO dbo.LOP
VALUES ('dl01' , N'Dữ liệu 1',1,N'Chính Quy',2007,'khmt')
INSERT INTO dbo.LOP
VALUES ('dl02' , N'Dữ liệu 2',2,N'Chính Quy',2008,'khmt')
INSERT INTO dbo.LOP
VALUES ('dh03a' , N'Dữ liệu 3 A',3,N'Chính Quy',2007,'khmt')
INSERT INTO dbo.LOP
VALUES ('kt01' , N'Kiến trúc 1',1,N'Chính Quy',2007,'cnud')
INSERT INTO dbo.LOP
VALUES ('kt03' , N'Kiến trúc 3',3,N'Chính Quy',2009,'cnud')
INSERT INTO dbo.LOP
VALUES ('lt01a' , N'Lập trình 1 A',1,N'Chính Quy',2007,'khmt')
INSERT INTO dbo.LOP
VALUES ('lt01b' , N'Lập trình 1 B',1,N'Chính Quy',2007,'khmt')
INSERT INTO dbo.LOP
VALUES ('lt02' , N'Lập trình 2',2,N'Chính Quy',2008,'khmt')
INSERT INTO dbo.LOP
VALUES ('mm01' , N'Mạng máy tính 1',1,N'Chính Quy',2007,'khmt')
INSERT INTO dbo.LOP
VALUES ('mm02' , N'Mạng máy tính 2',2,N'Chính Quy',2008,'khmt')
INSERT INTO dbo.LOP
VALUES ('qc02a' , N'Quảng cáo 2A',1,N'Chính Quy',2008,'tmdt')
INSERT INTO dbo.LOP
VALUES ('tm01' , N'Thương mại điện tử 1',1,N'Chính Quy',2007,'tmdt')
INSERT INTO dbo.LOP
VALUES ('tm02' , N'Thương mại điện tử 2',2,N'Chính Quy',2008,'tdmt')
INSERT INTO dbo.LOP
VALUES ('tm03' , N'Thương mại điện tử 3',3,N'Chính Quy',2009,'tmdt')


INSERT INTO dbo.SINHVIEN
VALUES('dh01-005',N'Phạm Duy',N'Phương','1986/03/15 12:00:00','TRUE',N'Bố Trạch , Quảng Bình','dh01')
INSERT INTO dbo.SINHVIEN
VALUES('dh02-002',N'Mai Thị',N'Kiều','1983/02/03 12:00:00','FALSE',N'Điện Bàn , Quảng Nam','dh02')
INSERT INTO dbo.SINHVIEN
VALUES('dh03-001',N'Nguyễn Như',N'Vũ','1986/07/25 12:00:00','TRUE',N'Hải Châu , Đà Nẵng','dh03')
INSERT INTO dbo.SINHVIEN
VALUES('dl01-001',N'Trần Tuấn',N'Anh','1983/01/01 12:00:00','TRUE',N'Sơn Trà , Đà Nẵng','dl01')
INSERT INTO dbo.SINHVIEN
VALUES('dl01-002',N'Nguyễn Thị',N'Lan','1986/03/13 12:00:00','FALSE',N'Mộ Đức , Quảng Ngãi','dl01')
INSERT INTO dbo.SINHVIEN
VALUES('dl01-003',N'Đào Thị',N'Cúc','1987/11/11 12:00:00','FALSE',N'Sơn Tịnh , Quảng Ngãi','dl01')
INSERT INTO dbo.SINHVIEN
VALUES('dh02-007',N'Nguyễn Thị',N'Đào','1984/03/26 12:00:00','FALSE',N'Phú Thượng , Huế','dl02')
INSERT INTO dbo.SINHVIEN
VALUES('lt01-001',N'Nguyễn Văn',N'Nghĩa','1985/08/23 12:00:00','TRUE',N'Điện Bàn , Quảng Nam','lt01a')
INSERT INTO dbo.SINHVIEN
VALUES('lt01-002',N'Ngô Phương',N'Thảo','1986/11/12 12:00:00','FALSE',N'Vĩnh Linh , Quảng Trị','lt01b')
INSERT INTO dbo.SINHVIEN
VALUES('mm01-010',N'Lê Văn',N'Bằng','1984/07/02 12:00:00','TRUE',N'Kỳ Anh , Hà Tĩnh','mm01')
INSERT INTO dbo.SINHVIEN
VALUES('tm01-020',N'Hà Ngọc',N'Anh','1982/12/12 12:00:00','TRUE',N'Thăng Bình , Quảng Nam','tm01')

INSERT INTO dbo.HOCPHAN
VALUES('hoa',N'Hóa đại cương', 3)
INSERT INTO dbo.HOCPHAN
VALUES('javacb',N'Java cơ bản', 3)
INSERT INTO dbo.HOCPHAN
VALUES('ltc',N'Lập trình C++', 3)
INSERT INTO dbo.HOCPHAN
VALUES('nlhdh',N'Nguyên lý hệ điều hành', 3)
INSERT INTO dbo.HOCPHAN
VALUES('nlkt',N'Nguyên lý kế toán', 3)
INSERT INTO dbo.HOCPHAN
VALUES('orac',N'Oracle', 3)
INSERT INTO dbo.HOCPHAN
VALUES('sql',N'HQTCSDL SQL Server', 3)
INSERT INTO dbo.HOCPHAN
VALUES('tindc',N'Tin học đại cương', 4)
INSERT INTO dbo.HOCPHAN
VALUES('Tinvp',N'Tin học văn phòng', 3)
INSERT INTO dbo.HOCPHAN
VALUES('tkms',N'Thiết kế màu sắc', 2)
INSERT INTO dbo.HOCPHAN
VALUES('triet',N'Triết học', 3)
INSERT INTO dbo.HOCPHAN
VALUES('trr',N'Toán rời rạc', 3)

INSERT INTO dbo.DIEMTHI
VALUES('nlkt','tm01-020',1,9.00)
INSERT INTO dbo.DIEMTHI
VALUES('sql','dl01-001',1,8.00)
INSERT INTO dbo.DIEMTHI
VALUES('sql','dl01-002',1,5.00)
INSERT INTO dbo.DIEMTHI
VALUES('sql','dl01-003',1,3.00)
INSERT INTO dbo.DIEMTHI
VALUES('sql','dl01-003',2,7.00)
INSERT INTO dbo.DIEMTHI
VALUES('tindc','dl01-001',1,7.00)
INSERT INTO dbo.DIEMTHI
VALUES('tindc','dl01-002',1,4.00)
INSERT INTO dbo.DIEMTHI
VALUES('tindc','dl01-002',2,6.00)
INSERT INTO dbo.DIEMTHI
VALUES('tindc','dl01-003',1,9.00)
INSERT INTO dbo.DIEMTHI
VALUES('tindc','tm01-020',1,8.00)
INSERT INTO dbo.DIEMTHI
VALUES('tinvp','dh01-005',1,3.00)
INSERT INTO dbo.DIEMTHI
VALUES('tinvp','dh01-005',2,4.00)
INSERT INTO dbo.DIEMTHI
VALUES('tinvp','dl01-001',1,10.00)
INSERT INTO dbo.DIEMTHI
VALUES('tinvp','dl01-002',1,6.00)
INSERT INTO dbo.DIEMTHI
VALUES('tinvp','dl01-003',1,10.00)
INSERT INTO dbo.DIEMTHI
VALUES('HQTCSDL SQL Server','dl01-003',2,10.00)
SELECT * FROM dbo.SINHVIEN
SELECT * FROM dbo.DIEMTHI
SELECT * FROM dbo.HOCPHAN
SELECT * FROM dbo.KHOA
SELECT * FROM dbo.LOP
SELECT * FROM dbo.SINHVIEN
--11.1
SELECT * FROM dbo.SINHVIEN
--11.2
SELECT * FROM dbo.HOCPHAN
SELECT MAHOCPHAN AS 'Mã Học Phần' , TENHOCPHAN AS 'Tên Học Phần' FROM dbo.HOCPHAN WHERE SOTINCHI > 3
--11.3
SELECT * FROM dbo.SINHVIEN WHERE GIOITINH = 0 ORDER BY TEN
--11.4
SELECT DIEMTHI.MASV , SINHVIEN.HODEM , SINHVIEN.TEN , DIEMTHI.DIEM FROM dbo.DIEMTHI , dbo.SINHVIEN 
WHERE DIEMTHI.MASV = SINHVIEN.MASV AND MAHOCPHAN = 'tindc' AND DIEMTHI.LANTHI = 1
--11.5
SELECT DISTINCT SINHVIEN.MASV , SINHVIEN.HODEM , SINHVIEN.TEN , LOP.TENLOP , LOP.NAMNHAPHOC FROM dbo.SINHVIEN , dbo.LOP 
WHERE SINHVIEN.MALOP = LOP.MALOP AND  MAKHOA = 'khmt'
--11.6
SELECT DISTINCT SINHVIEN.MASV , SINHVIEN.HODEM , SINHVIEN.TEN , LOP.TENLOP FROM dbo.SINHVIEN , dbo.LOP , dbo.DIEMTHI
WHERE SINHVIEN.MASV = DIEMTHI.MASV 
AND SINHVIEN.MALOP = LOP.MALOP  
AND GIOITINH = 0 
AND DIEMTHI.MAHOCPHAN = 'sql' 
AND DIEMTHI.LANTHI = 2
--11.7
SELECT DISTINCT SINHVIEN.MASV , SINHVIEN.HODEM , SINHVIEN.TEN , LOP.TENLOP , HOCPHAN.TENHOCPHAN , DIEMTHI.DIEM , KHOA.TENKHOA FROM dbo.KHOA , dbo.SINHVIEN ,dbo.LOP,dbo.HOCPHAN , dbo.DIEMTHI
WHERE LOP.KHOAHOC = 1	
AND SINHVIEN.MASV = DIEMTHI.MASV
AND DIEMTHI.MAHOCPHAN = HOCPHAN.MAHOCPHAN
AND KHOA.MAKHOA = LOP.MAKHOA
AND LOP.MALOP = SINHVIEN.MALOP
AND DIEMTHI.DIEM >=8 
AND DIEMTHI.DIEM <=9
--11.8
SELECT DISTINCT SINHVIEN.MASV , SINHVIEN.HODEM , SINHVIEN.TEN , DIEMTHI.DIEM FROM SINHVIEN , DIEMTHI
WHERE DIEMTHI.LANTHI = 1
AND SINHVIEN.MASV  = DIEMTHI.MASV
--11.9
SELECT KHOA.MAKHOA , KHOA.TENKHOA ,COUNT(SINHVIEN.MASV) AS 'Số sinh viên'
FROM KHOA , SINHVIEN , LOP
WHERE LOP.MAKHOA = KHOA.MAKHOA
AND SINHVIEN.MALOP = LOP.MALOP
GROUP BY KHOA.MAKHOA , KHOA.TENKHOA
--11.10
SELECT SINHVIEN.MaLop, LOP.TenLop, COUNT(SINHVIEN.MaSV) AS 'Số sinh viên'
FROM SINHVIEN, LOP
WHERE SINHVIEN.MaLop = LOP.MaLop
GROUP BY SINHVIEN.MaLop, LOP.TenLop
HAVING  COUNT(SINHVIEN.MaSV)>=2
--11.11
SELECT DISTINCT SINHVIEN.MASV , SINHVIEN.HODEM , SINHVIEN.TEN , LOP.TENLOP FROM SINHVIEN , LOP , DIEMTHI
WHERE DIEMTHI.LANTHI = 1 
AND SINHVIEN.MALOP = LOP.MALOP
AND DIEMTHI.DIEM > 7
--11.12
select year(getdate())-year(SINHVIEN.NGAYSINH) 'Tuổi',count(SINHVIEN.MASV) AS 'Số sinh viên'
from SINHVIEN
WHERE N'Tuổi' = '23'
group by year(getdate())-year(SINHVIEN.NGAYSINH)
--11.13
SELECT DISTINCT SINHVIEN.MASV , SINHVIEN.HODEM ,SINHVIEN.TEN , MAX(DIEMTHI.DIEM) FROM SINHVIEN , HOCPHAN , DIEMTHI
WHERE HOCPHAN.MAHOCPHAN = 'sql'
AND DIEMTHI.LANTHI = 1
AND SINHVIEN.MASV = DIEMTHI.MASV
AND HOCPHAN.MAHOCPHAN = DIEMTHI.MAHOCPHAN
GROUP BY SINHVIEN.MASV , SINHVIEN.HODEM , SINHVIEN.TEN , DIEMTHI.DIEM

SELECT DIEMTHI.MASV FROM DIEMTHI
WHERE DIEMTHI.LANTHI = 2
AND (DIEMTHI.MAHOCPHAN = 'tinvp'
OR DIEMTHI.MAHOCPHAN = 'tindc')

SELECT DIEMTHI.MASV FROM DIEMTHI
WHERE DIEMTHI.MAHOCPHAN = 'tinvp'
INTERSECT
SELECT DIEMTHI.MASV FROM DIEMTHI
WHERE DIEMTHI.MAHOCPHAN = 'tindc'
 

--1
SELECT * FROM SINHVIEN
--2
SELECT SINHVIEN.MASV , SINHVIEN.HODEM , SINHVIEN.TEN FROM SINHVIEN , LOP
WHERE LOP.KHOAHOC = 1
AND SINHVIEN.MALOP = LOP.MALOP
--3
SELECT SINHVIEN.MASV , SINHVIEN.HODEM,SINHVIEN.TEN , SINHVIEN.NGAYSINH , SINHVIEN.GIOITINH FROM SINHVIEN
WHERE SINHVIEN.GIOITINH = 0
ORDER BY SINHVIEN.HODEM , SINHVIEN.TEN
--4 
SELECT SINHVIEN.MASV , SINHVIEN.HODEM , SINHVIEN.TEN , DIEMTHI.DIEM FROM SINHVIEN , DIEMTHI
WHERE SINHVIEN.MASV = DIEMTHI.MASV
AND DIEMTHI.LANTHI = 1
AND DIEMTHI.MAHOCPHAN = 'sql'
--5
SELECT DISTINCT SINHVIEN.MASV , SINHVIEN.HODEM , SINHVIEN.TEN , LOP.TENLOP FROM SINHVIEN , LOP , HOCPHAN , DIEMTHI
WHERE SINHVIEN.MALOP = LOP.MALOP 
AND SINHVIEN.GIOITINH = 1
AND HOCPHAN.TENHOCPHAN = 'HQTCSDL SQL Server'
AND DIEMTHI.LANTHI = 2
--6 
SELECT DISTINCT LOP.MALOP AS ' Mã Lớp '   , LOP.TENLOP AS ' Tên Lớp' FROM LOP , KHOA
WHERE KHOA.MAKHOA = 'khmt'
--7 
SELECT SINHVIEN.MASV , SINHVIEN.HODEM , SINHVIEN.TEN , LOP.TENLOP , LOP.NAMNHAPHOC 
FROM (LOP INNER JOIN SINHVIEN ON SINHVIEN.MALOP = LOP.MALOP)
INNER JOIN KHOA ON LOP.MAKHOA = KHOA.MAKHOA
WHERE KHOA.MAKHOA = 'tmdt'
--8
SELECT DISTINCT HOCPHAN.TENHOCPHAN , HOCPHAN.SOTINCHI FROM HOCPHAN
--9
SELECT SINHVIEN.MASV , SINHVIEN.HODEM , SINHVIEN.TEN  FROM SINHVIEN , DIEMTHI
WHERE DIEMTHI.LANTHI = 2
AND SINHVIEN.MASV = DIEMTHI.MASV
AND(DIEMTHI.MAHOCPHAN = 'tinvp'
OR DIEMTHI.MAHOCPHAN = 'sql')
--10
SELECT DISTINCT  SINHVIEN.MASV ,SINHVIEN.HODEM , SINHVIEN.TEN , MAX(DIEMTHI.DIEM) AS 'Điểm' 
FROM SINHVIEN , DIEMTHI
WHERE SINHVIEN.MASV = DIEMTHI.MASV
AND DIEMTHI.LANTHI = 1
AND DIEMTHI.MAHOCPHAN = 'sql'
AND DIEMTHI.DIEM >= 5
GROUP BY SINHVIEN.MASV , SINHVIEN.HODEM , SINHVIEN.TEN 
--11
SELECT DISTINCT  SINHVIEN.MASV ,SINHVIEN.HODEM , SINHVIEN.TEN , DIEMTHI.DIEM 
FROM SINHVIEN, DIEMTHI , HOCPHAN
WHERE SINHVIEN.MASV = DIEMTHI.MASV
AND DIEMTHI.MAHOCPHAN = HOCPHAN.MAHOCPHAN
AND HOCPHAN.MAHOCPHAN = 'Tinvp'
AND DIEMTHI.LANTHI = 1	
AND (DIEMTHI.DIEM >= 5 AND DIEMTHI.DIEM <=7)
--12
SELECT DISTINCT  SINHVIEN.MASV ,SINHVIEN.HODEM , SINHVIEN.TEN , DIEMTHI.DIEM ,LOP.TENLOP
FROM SINHVIEN , DIEMTHI , LOP , HOCPHAN
WHERE SINHVIEN.MASV = DIEMTHI.MASV
AND SINHVIEN.MALOP = LOP.MALOP
AND DIEMTHI.MAHOCPHAN = HOCPHAN.MAHOCPHAN
AND DIEMTHI.LANTHI = 1
AND HOCPHAN.MAHOCPHAN = 'Tindc'
AND (DIEMTHI.DIEM = 4 OR  DIEMTHI.DIEM = 6 OR DIEMTHI.DIEM = 8)
--13
SELECT	DISTINCT  SINHVIEN.MASV ,SINHVIEN.HODEM , SINHVIEN.TEN FROM SINHVIEN 
WHERE SINHVIEN.GIOITINH = 0
AND SINHVIEN.HODEM LIKE 'Ngô%' ORDER BY HODEM 
--14
SELECT DISTINCT SINHVIEN.MASV , SINHVIEN.HODEM , SINHVIEN.TEN , LOP.TENLOP , HOCPHAN.TENHOCPHAN , DIEMTHI.DIEM , KHOA.TENKHOA FROM dbo.KHOA , dbo.SINHVIEN ,dbo.LOP,dbo.HOCPHAN , dbo.DIEMTHI
WHERE LOP.KHOAHOC = 1	
AND SINHVIEN.MASV = DIEMTHI.MASV
AND DIEMTHI.MAHOCPHAN = HOCPHAN.MAHOCPHAN
AND KHOA.MAKHOA = LOP.MAKHOA
AND LOP.MALOP = SINHVIEN.MALOP
AND DIEMTHI.DIEM >=8 
AND DIEMTHI.DIEM <=9
--15
SELECT DISTINCT SINHVIEN.MASV , SINHVIEN.HODEM , SINHVIEN.TEN , SINHVIEN.NGAYSINH , DIEMTHI.LANTHI , DIEMTHI.DIEM INTO	SINHVIENTINHOCDAICUONG
FROM SINHVIEN , DIEMTHI , HOCPHAN
WHERE SINHVIEN.MASV = DIEMTHI.MASV
AND DIEMTHI.MAHOCPHAN = HOCPHAN.MAHOCPHAN
AND	HOCPHAN.MAHOCPHAN = 'tindc'













SELECT * FROM dbo.SINHVIEN
SELECT * FROM dbo.DIEMTHI
SELECT * FROM dbo.HOCPHAN
SELECT * FROM dbo.KHOA
SELECT * FROM dbo.LOP
SELECT * FROM dbo.SINHVIEN
SELECT * FROM SINHVIENTINHOCDAICUONG
TRUNCATE TABLE DIEMTHI

DELETE FROM dbo.DIEMTHI

DROP TABLE DIEMTHI

ALTER TABLE HOCPHAN	
ADD CHECK (SOTINCHI > 0)

ALTER TABLE DIEMTHI	
ADD CHECK (DIEM >=0 AND DIEM <=10)

ALTER TABLE DIEMTHI	
ADD CHECK (LANTHI = 1 OR LANTHI =2)


ALTER TABLE KHOA
ADD UNIQUE (TENKHOA)
